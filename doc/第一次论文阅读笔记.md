#第一次论文研读
##Dune: Safe User-level Access to Privileged CPU Features
Dune实现了一种操作系统。该操作系统在user-level下可以访问某些CPU的特权指令，从而在cpu、文件系统等方面有效地提高了性能(相比于linux)，同时，可以做到在IO部分基本持平。

为提高虚拟化性能，简化 VMM 执行，英特尔推出了 VT-x，即x86 ISA的虚拟化扩展。在VT-x的设计中，CPU被分为了两种模式：VMX root 和VMX non-root。基于VT-x的VMX技术，dune进行了如下拓展：

进程是对cpu的抽象，要让每个进程都感觉自己在“独占”cpu，就需要采用隔离机制。由此，cpu在用户态-内核态切换，或者进程之间切换的开销很大。

Dune利用VT-x的特性，将硬件资源被一分为二，分别交给kernel态和guest态使用。guest态由kernel态下的进程产生，kernel态可以感知guest的内存分配等状况。
Dune很重要的一点创新是充分利用了硬件特性；guest自己拥有r0到r3不同的级别，维护了自己的页表，因此许多原来Kernel级别的指令可以直接在guest态执行，由此减少了内核态-用户态进程切换的开销。在non root下，Dune提供了一个类库lib dure，用以帮助应用来管理non root分配的资源，其实相当于自己实现了一个小的操作系统。

内存管理部分，kernel向guest态提供了一部分内存资源，在guest看来，他们看到的就是物理地址，但实际上，guest的物理地址到真实的物理地址之间还有一层转换，这一转换由Kernel的EPT（拓展页表）实现；

在system call方面，guest下的应用借助VMCALL来调用Kernel级别的指令；在传递信号量方面，系统原有的硬中断照旧，但是原来的软中断（如传递信号量等），由于进程隔离，可能无法直接从Kernel态传递给guest 态。这里Dune采用了一个小技巧，即将软中断变成了特殊的虚拟硬件中断，同时在guest态重载了硬中断的处理方式，这样就可以直接从kernel发给guest。

综上，由于有了intel新的硬件支持，Dune在用户态和内核态分别维护了自己的内存、寄存器等等资源，这样许多用户态自己可以管理的资源就不需要切换到内核态，从而很大的减小了开销。

##IX: A Protected Dataplane Operating System for High Throughput and Low Latency
本文是上文的延续，重点解决了IO问题。通常来说，IO的要求是packet个高传输率和低延迟，这些通常放在Kernel之外处理。本文设计了IX（a dataplane operating system)，提供了一种高IO性能的系统，同时仍然保持了现有内核所具有的优势：高防护性。

目前计算机在硬件上得到了极大的发展，多核的cpu，高主频，以及ssd变得更加普及。但是这相应的带来了问题。现在流行的软件（或者说应用）仍然是基于多个应用共享一个cpu的情景而设计的，各种中断、切换等的处理和优化也都基于此而设计。软硬件出现了分歧。之前的解决方案也有考虑建立用户空间的网络栈，这样可以消除掉内核态切换时的开销。但是这样的设计仍然需要在packet rate与latency之间谋求一种平衡。

IX使用了硬件虚拟化去独立管理和调度内核中国关于网络进程的函数。

IX从内核中分割出了一部分功能，这部分主要负责配置、调度、资源分配和监控。这样的分配使得我们可以从根本上考虑一种“全新”的IO API设计方式，同时还不影响原有的操作系统功能，如文件系统支持等，这样保证了兼容性。

IX的控制平面（control plane）包括全部的Linux内核以及IXCP（一种用户级的程序）Linux内核初始化了PCIe设（如Nic），并提供一种负责资源分配的基本机制包括内核、内存和网络队列等等。另一项重要部分是，Linux提供各种应用所必需的系统调用和服务，如文件系统和信号支持的兼容性。IXCP监控资源的使用情况，以及dataplane的性能、资源分配策略。

实现方面，每个IX的dataplane作为一个单独地址空间操作系统，他可以运行两种线程类型，他们是用户级的地址空间:(i)弹性线程，他继承自IX dataplane，用来初始化并使用网络I/O； （ii）后台线程。以上两者都可以调用任意的操作系统接口，但在调用之前都需要经过dataplane的中转和检验，之后才可以转发给Linux内核。
